{% macro renderMethodDefinition(method) %}
{% if method.deprecationMessage %}@Deprecated("{{ method.deprecationMessage }}"){% endif %}
{% if method.isStaticMethod %}@JvmStatic{% endif %}
fun {{ method.originalName }}({{ method.parameters }}){% if method.returnType != 'Unit' %}: {{ method.returnType }}{% endif %} {
{% for callback in method.callbacks %}
    // Create callback for {{ callback.parameterName }}
    val {{ callback.parameterName }}Callback = object : {{ callback.callbackInterfaceName }} {
    override fun callback(ptr: Pointer) {
    val obj = {{ callback.argumentTypeName }}(ptr)
    {{ callback.parameterName }}(obj)
    }
    }
    callbacks.add({{ callback.parameterName }}Callback)

{% endfor %}
{% if method.returnType == 'Unit' %}
    lib().{{ method.nativeMethodName }}({{ method.nativeCallArgs }})
{% elsif method.returnsPointer %}
    val result = lib().{{ method.nativeMethodName }}({{ method.nativeCallArgs }})
    return {{ method.returnClassName }}(result)
{% else %}
    return lib().{{ method.nativeMethodName }}({{ method.nativeCallArgs }})
{% endif %}
}
{% endmacro %}

// ============================================================================
// {{ className }} - Native Function Interface
// ============================================================================

{{ customDefinitions }}

/**
 * JNA interface for {{ className }} native methods.
 */
private interface {{ className }}Native : Library {
{% for method in methods %}
    fun {{ method.nativeMethodName }}({% unless method.isStaticMethod %}target: Pointer{% for param in method.parameterDetails %}, {{ param.name }}: {{ param.nativeType }}{% endfor %}{% else %}{% for param in method.parameterDetails %}{% if forloop.first == false %}, {% endif %}{{ param.name }}: {{ param.nativeType }}{% endfor %}{% endunless %}): {{ method.nativeReturnType }}
{% endfor %}

{{ customInit }}
}

// ============================================================================
// {{ className }} Callback Interfaces
// ============================================================================

{% for callback in callbackInterfaces %}
/**
 * Callback interface for {{ callback.argumentTypeName }} configuration.
 */
interface {{ callback.interfaceName }} : Callback {
    fun callback(ptr: Pointer)
}

{% endfor %}
// ============================================================================
// {{ className }} Class
// ============================================================================

/**
 * {{ className }} wrapper for the native QuestPDF {{ className }}.
 */
class {{ className }} internal constructor(val pointer: Pointer) {
    private val callbacks = mutableListOf<Callback>()

    companion object {
        private var nativeLib: {{ className }}Native? = QuestLibrary.getLibrary({{ className }}Native::class.java)
        private val initLock = Any()

        private fun lib(): {{ className }}Native {
            return nativeLib!!
        }

    {% for method in methods %}
        {% if method.isStaticMethod %} {{ renderMethodDefinition(method) }} {% endif %}
    {% endfor %}
    }
    
{% for method in methods %}
{% unless method.isStaticMethod %} {{ renderMethodDefinition(method) }} {% endunless %}
{% endfor %}

    {{ customClass }}
}
